# 测试

## 11.1 go test

`go test` 命令是一个按照一定的约定和组织来测试代码的程序。在包目录内，所有以 `_test.go` 为后缀名的源文件在执行 `go build` 时不会被构建成包的一部分，它们是 `go test` 测试的一部分。

在 `*_test.go` 文件中，有三种类型的函数：测试函数、基准测试（benchmark）函数、示例函数。一个测试函数是以 Test 为函数名前缀的函数，用于测试程序的一些逻辑行为是否正确；`go test` 命令会调用这些测试函数并报告测试结果是 PASS 或 FAIL。基准测试函数是以 Benchmark 为函数名前缀的函数，它们用于衡量一些函数的性能；`go test` 命令会多次运行基准测试函数以计算一个平均的执行时间。示例函数是以 Example 为函数名前缀的函数，提供一个由编译器保证正确性的示例文档。我们将在 11.2 节讨论测试函数的所有细节，并在 11.4 节讨论基准测试函数的细节，然后在 11.6 节讨论示例函数的细节。

`go test` 命令会遍历所有的 `*_test.go` 文件中符合上述命名规则的函数，生成一个临时的 main 包用于调用相应的测试函数，接着构建并运行、报告测试结果，最后清理测试中生成的临时文件。

## 11.2 测试函数

### 11.2.1 随机测试

### 11.2.2 测试一个命令

### 11.2.3 白盒测试

### 11.2.4 外部测试包

### 11.2.5 编写有效的测试

### 11.2.6 避免脆弱的测试

避免脆弱测试代码的方法是只检测你真正关心的属性。保持测试代码的简洁和内部结构的稳定。特别是对断言部分要有所选择。不要对字符串进行全字匹配，而是针对那些在项目的发展中是比较稳定不变的子串。很多时候值得花力气来编写一个从复杂输出中提取用于断言的必要信息的函数，虽然这可能会带来很多前期的工作，但是它可以帮助迅速及时修复因为项目演化而导致的不合逻辑的失败测试。

## 11.3 测试覆盖率

就性质而言，测试不可能是完整的。计算机科学家 Edsger Dijkstra 曾说过：“测试能证明缺陷存在，而无法证明没有缺陷。”再多的测试也不能证明一个程序没有 BUG。在最好的情况下，测试可以增强我们的信心：代码在很多重要场景下是可以正常工作的。

对待测程序执行的测试的程度称为测试的覆盖率。测试覆盖率并不能量化——即使最简单的程序的动态也是难以精确测量的——但是有启发式方法来帮助我们编写有效的测试代码。

## 11.4 基准测试

## 11.5 剖析

## 11.6 示例函数
